<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abu Cargo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .form-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 2px;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: #27ae60;
        }

        .btn-success:hover {
            background-color: #219a52;
        }

        .btn-telegram {
            background-color: #0088cc;
        }

        .btn-telegram:hover {
            background-color: #0077b3;
        }

        .btn-block {
            display: block;
            width: 100%;
            padding: 12px;
        }

        .link {
            text-align: center;
            margin-top: 15px;
        }

        .link a {
            color: #3498db;
            text-decoration: none;
        }

        .link a:hover {
            text-decoration: underline;
        }

        .dashboard {
            display: none;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: #34495e;
            color: white;
            transition: left 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background-color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            border-bottom: 1px solid #3c5064;
        }

        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .sidebar-menu a:hover {
            background-color: #3c5064;
        }

        .content {
            padding: 20px;
        }

        .section {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .user-code {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .user-code h4 {
            margin-bottom: 10px;
        }

        .user-code p {
            margin-bottom: 5px;
        }

        .add-track-form {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }

        .profile-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .profile-card h3 {
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .profile-info {
            margin-top: 15px;
        }

        .profile-info p {
            margin: 8px 0;
            display: flex;
            align-items: center;
        }

        .profile-info i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th,
        table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        table tr:hover {
            background-color: #f5f5f5;
        }

        .status-select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .track-input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
        }

        .user-select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }

        @media (max-width: 768px) {
            .form-container {
                margin: 20px auto;
                padding: 20px;
            }

            .sidebar {
                width: 100%;
                left: -100%;
            }

            table {
                display: block;
                overflow-x: auto;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="loginForm" class="form-container">
        <h2>–í—Ö–æ–¥ –≤ Abu Cargo</h2>
        <form id="loginFormElement">
            <div class="form-group">
                <label for="loginPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" id="loginPhone" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="btn btn-block">–í–æ–π—Ç–∏</button>
        </form>
        <div class="link">
            <a href="#" id="showRegister">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
        </div>
    </div>

    <div id="registerForm" class="form-container" style="display: none;">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Abu Cargo</h2>
        <form id="registerFormElement">
            <div class="form-group">
                <label for="registerName">–§–ò–û</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" id="registerPhone" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="registerPassword" required>
            </div>
            <div class="form-group">
                <label for="registerPvz">–ü–í–ó</label>
                <select id="registerPvz" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ü–í–ó</option>
                    <option value="–ù–∞—Ä–∏–º–∞–Ω">–ù–∞—Ä–∏–º–∞–Ω</option>
                    <option value="–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö">–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö</option>
                    <option value="–î–æ—Å—Ç—É–∫">–î–æ—Å—Ç—É–∫</option>
                </select>
            </div>
            <button type="submit" class="btn btn-block">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <div class="link">
            <a href="#" id="showLogin">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π–¥–∏—Ç–µ</a>
        </div>
    </div>

    <div id="userDashboard" class="dashboard">
        <div class="header">
            <div class="container header-content">
                <button class="menu-btn" id="menuBtn">‚ò∞</button>
                <h1 id="dashboardTitle">Abu Cargo ‚Äî —Ç–≤–æ–π –∫–æ–¥ YX1</h1>
                <button class="btn btn-secondary" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>–ú–µ–Ω—é</h3>
                <button class="close-btn" id="closeBtn">√ó</button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" data-section="profile">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><a href="#" data-section="personalData">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</a></li>
                <li><a href="#" data-section="changePassword">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</a></li>
                <li><a href="#" data-section="orderStatus">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a></li>
                <li><a href="#" data-section="addOrder">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</a></li>
            </ul>
        </div>

        <div class="container content">
            <div id="profile" class="section active">
                <div class="profile-card">
                    <h3>üìÉ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
                    <div class="profile-info" id="profileInfo"></div>
                    <button class="btn btn-telegram" id="shareToTelegram" style="margin-top: 15px;">
                        üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram
                    </button>
                </div>
                
                <div class="user-code">
                    <h4>–ê–¥—Ä–µ—Å –≤ –ö–∏—Ç–∞–µ:</h4>
                    <p id="chinaAddress"></p>
                </div>
            </div>

            <div id="personalData" class="section">
                <h3>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <form id="personalDataForm">
                    <div class="form-group">
                        <label for="editName">–§–ò–û</label>
                        <input type="text" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label for="editPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="tel" id="editPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="editPvz">–ü–í–ó</label>
                        <select id="editPvz" required>
                            <option value="–ù–∞—Ä–∏–º–∞–Ω">–ù–∞—Ä–∏–º–∞–Ω</option>
                            <option value="–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö">–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö</option>
                            <option value="–î–æ—Å—Ç—É–∫">–î–æ—Å—Ç—É–∫</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-block">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </form>
            </div>

            <div id="changePassword" class="section">
                <h3>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn btn-block">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </form>
            </div>

            <div id="orderStatus" class="section">
                <h3>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3>
                <div id="orderStatusContent">
                    <table>
                        <thead>
                            <tr>
                                <th>–¢—Ä–µ–∫ –∫–æ–¥</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="orderList"></tbody>
                    </table>
                </div>
            </div>

            <div id="addOrder" class="section">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
                <div class="add-track-form">
                    <form id="addOrderForm">
                        <div class="form-group">
                            <label for="trackCode">–¢—Ä–µ–∫ –∫–æ–¥</label>
                            <input type="text" id="trackCode" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫ –∫–æ–¥" required>
                        </div>
                        <button type="submit" class="btn btn-success btn-block">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
                    </form>
                </div>
                <p><small>–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –µ–º—É –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω —Å—Ç–∞—Ç—É—Å "–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è". –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í –ø—É—Ç–∏" –∏–ª–∏ "–ü–æ–ª—É—á–µ–Ω".</small></p>
            </div>
        </div>
    </div>

    <div id="adminDashboard" class="dashboard">
        <div class="header">
            <div class="container header-content">
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Abu Cargo</h1>
                <button class="btn btn-secondary" id="adminLogoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="container content">
            <div class="admin-nav" style="margin-bottom: 20px;">
                <button class="btn" data-admin-section="inTransit">–í—Å–µ –∑–∞–∫–∞–∑—ã</button>
                <button class="btn" data-admin-section="userSearch">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                <button class="btn" data-admin-section="allUsers">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            </div>

            <div id="inTransit" class="admin-section active">
                <h3>–í—Å–µ –∑–∞–∫–∞–∑—ã</h3>
                <div class="add-track-form" style="margin-bottom: 20px;">
                    <h4>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                    <form id="adminAddOrderForm">
                        <div class="form-group">
                            <label for="adminUserCode">–ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="adminUserCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: YX1)" required>
                        </div>
                        <div class="form-group">
                            <label for="adminTrackCode">–¢—Ä–µ–∫ –∫–æ–¥</label>
                            <input type="text" id="adminTrackCode" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫ –∫–æ–¥" required>
                        </div>
                        <div class="form-group">
                            <label for="adminOrderStatus">–°—Ç–∞—Ç—É—Å</label>
                            <select id="adminOrderStatus" required>
                                <option value="–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è">–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è</option>
                                <option value="–í –ø—É—Ç–∏">–í –ø—É—Ç–∏</option>
                                <option value="–ü–æ–ª—É—á–µ–Ω">–ü–æ–ª—É—á–µ–Ω</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
                    </form>
                </div>
                <div id="inTransitContent">
                    <table>
                        <thead>
                            <tr>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–ö–æ–¥</th>
                                <th>–¢—Ä–µ–∫ –∫–æ–¥</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="inTransitTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="userSearch" class="admin-section">
                <h3>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –∫–æ–¥—É">
                </div>
                <div id="searchResults">
                    <table>
                        <thead>
                            <tr>
                                <th>–ö–æ–¥</th>
                                <th>–§–ò–û</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–ü–í–ó</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="searchResultsTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="allUsers" class="admin-section">
                <h3>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                <div id="allUsersContent">
                    <table>
                        <thead>
                            <tr>
                                <th>–ö–æ–¥</th>
                                <th>–§–ò–û</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–ü–í–ó</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="allUsersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function initDatabase() {
            if (!localStorage.getItem('abucargo_users')) {
                const initialData = [];
                initialData.push({
                    id: 'admin1',
                    name: '–ú—É—Å—É–ª—å–º–∞ –ê–¥–º–∏–Ω',
                    phone: '+996997111118',
                    password: 'muslima06',
                    pvz: '–ê–¥–º–∏–Ω',
                    code: 'ADMIN1',
                    registrationDate: new Date().toISOString(),
                    isAdmin: true
                });
                initialData.push({
                    id: 'admin2', 
                    name: '–Æ—Å—É—Ñ –ê–¥–º–∏–Ω',
                    phone: '+996550997200',
                    password: 'yusuf09',
                    pvz: '–ê–¥–º–∏–Ω',
                    code: 'ADMIN2',
                    registrationDate: new Date().toISOString(),
                    isAdmin: true
                });
                localStorage.setItem('abucargo_users', JSON.stringify(initialData));
            }
            
            if (!localStorage.getItem('abucargo_next_code_yx')) {
                localStorage.setItem('abucargo_next_code_yx', '1');
            }
            if (!localStorage.getItem('abucargo_next_code_yq')) {
                localStorage.setItem('abucargo_next_code_yq', '1');
            }
            
            if (!localStorage.getItem('abucargo_orders')) {
                localStorage.setItem('abucargo_orders', JSON.stringify([]));
            }
        }

        function safeSetItem(key, value) {
            try {
                localStorage.setItem(key, value);
                return true;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                sessionStorage.setItem(key, value);
                return false;
            }
        }

        function safeGetItem(key) {
            try {
                return localStorage.getItem(key) || sessionStorage.getItem(key);
            } catch (e) {
                return sessionStorage.getItem(key);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–¥–º–∏–Ω–∞
        function getNextCode(adminPhone) {
            if (adminPhone === '+996997111118') {
                // –ê–¥–º–∏–Ω 1 - YX –∫–æ–¥—ã
                const nextCodeNum = parseInt(localStorage.getItem('abucargo_next_code_yx'));
                const nextCode = `YX${nextCodeNum}`;
                localStorage.setItem('abucargo_next_code_yx', (nextCodeNum + 1).toString());
                return nextCode;
            } else {
                // –ê–¥–º–∏–Ω 2 - YQ –∫–æ–¥—ã
                const nextCodeNum = parseInt(localStorage.getItem('abucargo_next_code_yq'));
                const nextCode = `YQ${nextCodeNum}`;
                localStorage.setItem('abucargo_next_code_yq', (nextCodeNum + 1).toString());
                return nextCode;
            }
        }

        function getPvzInfo(pvz) {
            const pvzInfo = {
                '–ù–∞—Ä–∏–º–∞–Ω': {
                    phone: '+996997111118',
                    address: '–ù–∞—Ä–∏–º–∞–Ω',
                    hours: '9:00 –î–û 18:00',
                    map: 'https://2gis.kg/bishkek/'
                },
                '–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö': {
                    phone: '+996997111118',
                    address: '–ñ–∏–π–¥–µ–ª–∏–∫ –£–ü–¢–ö, –£–ª–∏—Ü–∞ –ù–∞–±–∏ –•–æ–¥–∂–∞, 28/3',
                    hours: '9:00 –î–û 18:00',
                    map: 'https://2gis.kg/bishkek/geo/70030076876455182/72.781486,40.555853'
                },
                '–î–æ—Å—Ç—É–∫': {
                    phone: '+996997111118',
                    address: '–î–æ—Å—Ç—É–∫',
                    hours: '9:00 –î–û 18:00',
                    map: 'https://2gis.kg/bishkek/'
                }
            };
            return pvzInfo[pvz] || pvzInfo['–ñ–∏–π–¥–∞–ª–∏–∫ –£–ü–¢–ö'];
        }

        function simpleEncrypt(password) {
            return btoa(password);
        }

        function checkPassword(inputPassword, storedPassword, isAdmin = false) {
            if (isAdmin) {
                return inputPassword === storedPassword;
            }
            return simpleEncrypt(inputPassword) === storedPassword;
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –∞–¥–º–∏–Ω–∞
        function registerUser(name, phone, password, pvz, adminPhone) {
            try {
                const usersData = safeGetItem('abucargo_users');
                const users = usersData ? JSON.parse(usersData) : [];
                
                const userExists = users.some(user => user.phone === phone);
                if (userExists) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    return false;
                }
                
                const newUser = {
                    id: Date.now().toString(),
                    name: name,
                    phone: phone,
                    password: simpleEncrypt(password),
                    pvz: pvz,
                    code: getNextCode(adminPhone),
                    registrationDate: new Date().toISOString(),
                    isAdmin: false,
                    adminPhone: adminPhone
                };
                
                users.push(newUser);
                safeSetItem('abucargo_users', JSON.stringify(users));
                
                return newUser;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', e);
                return false;
            }
        }

        function loginUser(phone, password) {
            try {
                const usersData = safeGetItem('abucargo_users');
                if (!usersData) return null;
                
                const users = JSON.parse(usersData);
                const user = users.find(u => u.phone === phone);
                
                if (!user) return null;
                
                const isAdmin = user.isAdmin;
                if (checkPassword(password, user.password, isAdmin)) {
                    const userData = JSON.stringify(user);
                    safeSetItem('abucargo_active_user', userData);
                    sessionStorage.setItem('abucargo_active_user', userData);
                    return user;
                }
                return null;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', e);
                return null;
            }
        }

        function updateUser(userId, updates) {
            try {
                const usersData = safeGetItem('abucargo_users');
                const users = usersData ? JSON.parse(usersData) : [];
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    if (updates.password && !users[userIndex].isAdmin) {
                        updates.password = simpleEncrypt(updates.password);
                    }
                    
                    users[userIndex] = { ...users[userIndex], ...updates };
                    safeSetItem('abucargo_users', JSON.stringify(users));
                    return users[userIndex];
                }
                
                return null;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', e);
                return null;
            }
        }

        function getAllUsers() {
            try {
                const usersData = safeGetItem('abucargo_users');
                return usersData ? JSON.parse(usersData) : [];
            } catch (e) {
                return [];
            }
        }

        function getAllOrders() {
            try {
                const ordersData = safeGetItem('abucargo_orders');
                return ordersData ? JSON.parse(ordersData) : [];
            } catch (e) {
                return [];
            }
        }

        function addOrder(userId, trackCode, status = "–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è") {
            try {
                const orders = getAllOrders();
                const newOrder = {
                    id: Date.now().toString(),
                    userId: userId,
                    trackCode: trackCode,
                    status: status,
                    dateAdded: new Date().toISOString()
                };
                
                orders.push(newOrder);
                safeSetItem('abucargo_orders', JSON.stringify(orders));
                return newOrder;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:', e);
                return null;
            }
        }

        function updateOrder(orderId, updates) {
            try {
                const orders = getAllOrders();
                const orderIndex = orders.findIndex(o => o.id === orderId);
                
                if (orderIndex !== -1) {
                    orders[orderIndex] = { ...orders[orderIndex], ...updates };
                    safeSetItem('abucargo_orders', JSON.stringify(orders));
                    return orders[orderIndex];
                }
                
                return null;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:', e);
                return null;
            }
        }

        function deleteOrder(orderId) {
            try {
                const orders = getAllOrders();
                const updatedOrders = orders.filter(order => order.id !== orderId);
                safeSetItem('abucargo_orders', JSON.stringify(updatedOrders));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:', e);
            }
        }

        function searchUsers(query) {
            const users = getAllUsers();
            return users.filter(user => 
                user.name.toLowerCase().includes(query.toLowerCase()) ||
                user.phone.includes(query) ||
                user.code.toLowerCase().includes(query.toLowerCase())
            );
        }

        function getUserByCode(code) {
            const users = getAllUsers();
            return users.find(user => user.code === code);
        }

        // –ê–¥—Ä–µ—Å –≤ –ö–∏—Ç–∞–µ —Å –∫–æ–¥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
        function getChinaAddress(code) {
            return `Âæ°Áé∫${code}<br>15727306315<br>ÊµôÊ±üÁúÅÈáëÂçéÂ∏Ç‰πâ‰πåÂ∏ÇÂåóËãëË°óÈÅìÊò•Êôó‰∫åÂå∫36Ê†ãÂ•ΩËøêÂõΩÈôÖË¥ßËøê5697Â∫ìÂÖ•‰ªìÂè∑:Âæ°Áé∫${code}`;
        }

        function loginAsUser(userId) {
            const users = getAllUsers();
            const user = users.find(u => u.id === userId);
            if (user) {
                showDashboard(user);
            }
        }

        function generateTelegramText(user) {
            const pvzInfo = getPvzInfo(user.pvz);
            return `üìÉ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—åüìÉ

ü™™ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ö–û–î: ${user.code}
üë§ –§–ò–û: ${user.name}
üìû –ù–æ–º–µ—Ä: ${user.phone}
üè° –ê–¥—Ä–µ—Å: 

üìç –ü–í–ó: ${pvzInfo.address}
üìç –ü–í–ó —Ç–µ–ª–µ—Ñ–æ–Ω: ${pvzInfo.phone}
üìç –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: ${pvzInfo.hours}
üìç –õ–æ–∫–∞—Ü–∏—è –Ω–∞ –ö–∞—Ä—Ç–µ: ${pvzInfo.map}

–ê–¥—Ä–µ—Å –≤ –ö–∏—Ç–∞–µ:
Âæ°Áé∫${user.code}
15727306315
ÊµôÊ±üÁúÅÈáëÂçéÂ∏Ç‰πâ‰πåÂ∏ÇÂåóËãëË°óÈÅìÊò•Êôó‰∫åÂå∫36Ê†ãÂ•ΩËøêÂõΩÈôÖË¥ßËøê5697Â∫ìÂÖ•‰ªìÂè∑:Âæ°Áé∫${user.code}`;
        }

        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const userDashboard = document.getElementById('userDashboard');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginFormElement = document.getElementById('loginFormElement');
        const registerFormElement = document.getElementById('registerFormElement');
        const showRegisterLink = document.getElementById('showRegister');
        const showLoginLink = document.getElementById('showLogin');
        const menuBtn = document.getElementById('menuBtn');
        const closeBtn = document.getElementById('closeBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        const sections = document.querySelectorAll('.section');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const personalDataForm = document.getElementById('personalDataForm');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const addOrderForm = document.getElementById('addOrderForm');
        const adminAddOrderForm = document.getElementById('adminAddOrderForm');
        const adminNavButtons = document.querySelectorAll('.admin-nav button');
        const adminSections = document.querySelectorAll('.admin-section');
        const searchInput = document.getElementById('searchInput');
        const inTransitTable = document.getElementById('inTransitTable');
        const searchResultsTable = document.getElementById('searchResultsTable');
        const allUsersTable = document.getElementById('allUsersTable');
        const dashboardTitle = document.getElementById('dashboardTitle');
        const userCodeSpan = document.getElementById('userCodeSpan');
        const chinaAddress = document.getElementById('chinaAddress');
        const orderList = document.getElementById('orderList');
        const profileInfo = document.getElementById('profileInfo');
        const shareToTelegramBtn = document.getElementById('shareToTelegram');

        let currentUser = null;

        function setupEventListeners() {
            showRegisterLink.addEventListener('click', function(e) {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });
            
            showLoginLink.addEventListener('click', function(e) {
                e.preventDefault();
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });
            
            loginFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                const phone = document.getElementById('loginPhone').value;
                const password = document.getElementById('loginPassword').value;
                
                const user = loginUser(phone, password);
                if (user) {
                    showDashboard(user);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                }
            });
            
            registerFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const phone = document.getElementById('registerPhone').value;
                const password = document.getElementById('registerPassword').value;
                const pvz = document.getElementById('registerPvz').value;
                
                // –ü–µ—Ä–µ–¥–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω —Ç–µ–∫—É—â–µ–≥–æ –∞–¥–º–∏–Ω–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
                const adminPhone = currentUser.phone;
                const newUser = registerUser(name, phone, password, pvz, adminPhone);
                if (newUser) {
                    alert(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í–∞—à –∫–æ–¥: ${newUser.code}`);
                    showDashboard(newUser);
                }
            });
            
            menuBtn.addEventListener('click', function() {
                sidebar.classList.add('active');
            });
            
            closeBtn.addEventListener('click', function() {
                sidebar.classList.remove('active');
            });
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetSection = this.getAttribute('data-section');
                    
                    sections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(targetSection).classList.add('active');
                    sidebar.classList.remove('active');
                });
            });
            
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('abucargo_active_user');
                sessionStorage.removeItem('abucargo_active_user');
                loginForm.style.display = 'block';
                userDashboard.style.display = 'none';
                adminDashboard.style.display = 'none';
                registerForm.style.display = 'none';
                setTimeout(() => {
                    window.location.reload();
                }, 100);
            });
            
            adminLogoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('abucargo_active_user');
                sessionStorage.removeItem('abucargo_active_user');
                loginForm.style.display = 'block';
                userDashboard.style.display = 'none';
                adminDashboard.style.display = 'none';
                setTimeout(() => {
                    window.location.reload();
                }, 100);
            });
            
            personalDataForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('editName').value;
                const phone = document.getElementById('editPhone').value;
                const pvz = document.getElementById('editPvz').value;
                
                const updatedUser = updateUser(currentUser.id, { name, phone, pvz });
                if (updatedUser) {
                    currentUser = updatedUser;
                    const userData = JSON.stringify(currentUser);
                    safeSetItem('abucargo_active_user', userData);
                    sessionStorage.setItem('abucargo_active_user', userData);
                    updateUserInterface();
                    alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
                }
            });
            
            changePasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (newPassword !== confirmPassword) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }
                
                const updatedUser = updateUser(currentUser.id, { password: newPassword });
                if (updatedUser) {
                    currentUser = updatedUser;
                    const userData = JSON.stringify(currentUser);
                    safeSetItem('abucargo_active_user', userData);
                    sessionStorage.setItem('abucargo_active_user', userData);
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω');
                }
            });
            
            addOrderForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const trackCode = document.getElementById('trackCode').value;
                
                if (!trackCode) {
                    alert('–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫ –∫–æ–¥');
                    return;
                }
                
                addOrder(currentUser.id, trackCode);
                document.getElementById('trackCode').value = '';
                alert('–ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è"');
                loadUserOrders();
            });
            
            adminAddOrderForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const userCode = document.getElementById('adminUserCode').value;
                const trackCode = document.getElementById('adminTrackCode').value;
                const status = document.getElementById('adminOrderStatus').value;
                
                const user = getUserByCode(userCode);
                if (!user) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                addOrder(user.id, trackCode, status);
                document.getElementById('adminUserCode').value = '';
                document.getElementById('adminTrackCode').value = '';
                alert('–ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω');
                loadInTransitData();
            });
            
            adminNavButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetSection = this.getAttribute('data-admin-section');
                    
                    adminSections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(targetSection).classList.add('active');
                    
                    if (targetSection === 'inTransit') {
                        loadInTransitData();
                    } else if (targetSection === 'allUsers') {
                        loadAllUsersData();
                    }
                });
            });
            
            searchInput.addEventListener('input', function() {
                const query = this.value;
                if (query.length >= 2) {
                    const results = searchUsers(query);
                    displaySearchResults(results);
                } else {
                    searchResultsTable.innerHTML = '';
                }
            });

            shareToTelegramBtn.addEventListener('click', function() {
                const telegramText = generateTelegramText(currentUser);
                const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent('–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å Abu Cargo')}&text=${encodeURIComponent(telegramText)}`;
                window.open(telegramUrl, '_blank');
            });
        }

        function showDashboard(user) {
            currentUser = user;
            const userData = JSON.stringify(user);
            safeSetItem('abucargo_active_user', userData);
            sessionStorage.setItem('abucargo_active_user', userData);
            
            loginForm.style.display = 'none';
            registerForm.style.display = 'none';
            
            if (user.isAdmin) {
                adminDashboard.style.display = 'block';
                userDashboard.style.display = 'none';
                loadAdminData();
            } else {
                userDashboard.style.display = 'block';
                adminDashboard.style.display = 'none';
                updateUserInterface();
            }
        }

        function updateUserInterface() {
            dashboardTitle.textContent = `Abu Cargo ‚Äî —Ç–≤–æ–π –∫–æ–¥ ${currentUser.code}`;
            userCodeSpan.textContent = currentUser.code;
            chinaAddress.innerHTML = getChinaAddress(currentUser.code);
            
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editPhone').value = currentUser.phone;
            document.getElementById('editPvz').value = currentUser.pvz;
            
            updateProfileInfo();
            loadUserOrders();
        }

        function updateProfileInfo() {
            const pvzInfo = getPvzInfo(currentUser.pvz);
            
            profileInfo.innerHTML = `
                <p>ü™™ <strong>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ö–û–î:</strong> ${currentUser.code}</p>
                <p>üë§ <strong>–§–ò–û:</strong> ${currentUser.name}</p>
                <p>üìû <strong>–ù–æ–º–µ—Ä:</strong> ${currentUser.phone}</p>
                <p>üè° <strong>–ê–¥—Ä–µ—Å:</strong></p>
                <p>üìç <strong>–ü–í–ó:</strong> ${pvzInfo.address}</p>
                <p>üìç <strong>–ü–í–ó —Ç–µ–ª–µ—Ñ–æ–Ω:</strong> ${pvzInfo.phone}</p>
                <p>üìç <strong>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</strong> ${pvzInfo.hours}</p>
                <p>üìç <strong>–õ–æ–∫–∞—Ü–∏—è –Ω–∞ –ö–∞—Ä—Ç–µ:</strong> <a href="${pvzInfo.map}" target="_blank" style="color: white;">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</a></p>
            `;
        }

        function loadUserOrders() {
            const orders = getAllOrders();
            const userOrders = orders.filter(order => order.userId === currentUser.id);
            
            orderList.innerHTML = '';
            
            if (userOrders.length === 0) {
                orderList.innerHTML = '<tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                return;
            }
            
            userOrders.forEach(order => {
                const row = document.createElement('tr');
                const dateAdded = new Date(order.dateAdded).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>${order.trackCode}</td>
                    <td>${order.status}</td>
                    <td>${dateAdded}</td>
                    <td>
                        <button class="btn btn-danger delete-order" data-order-id="${order.id}">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                
                orderList.appendChild(row);
            });
            
            document.querySelectorAll('#orderList .delete-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order-id');
                    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
                        deleteOrder(orderId);
                        loadUserOrders();
                    }
                });
            });
        }

        function loadAdminData() {
            loadInTransitData();
            loadAllUsersData();
        }

        function loadInTransitData() {
            const orders = getAllOrders();
            const users = getAllUsers();
            
            inTransitTable.innerHTML = '';
            
            if (orders.length === 0) {
                inTransitTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                return;
            }
            
            orders.forEach(order => {
                const user = users.find(u => u.id === order.userId);
                if (!user) return;
                
                const row = document.createElement('tr');
                const dateAdded = new Date(order.dateAdded).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.code}</td>
                    <td>${order.trackCode}</td>
                    <td>
                        <select class="status-select" data-order-id="${order.id}">
                            <option value="–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è" ${order.status === '–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è' ? 'selected' : ''}>–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è</option>
                            <option value="–í –ø—É—Ç–∏" ${order.status === '–í –ø—É—Ç–∏' ? 'selected' : ''}>–í –ø—É—Ç–∏</option>
                            <option value="–ü–æ–ª—É—á–µ–Ω" ${order.status === '–ü–æ–ª—É—á–µ–Ω' ? 'selected' : ''}>–ü–æ–ª—É—á–µ–Ω</option>
                        </select>
                    </td>
                    <td>${dateAdded}</td>
                    <td>
                        <button class="btn btn-success save-order" data-order-id="${order.id}">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-danger delete-order" data-order-id="${order.id}">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                
                inTransitTable.appendChild(row);
            });
            
            document.querySelectorAll('.save-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order-id');
                    const statusSelect = document.querySelector(`.status-select[data-order-id="${orderId}"]`);
                    
                    const updates = {
                        status: statusSelect.value
                    };
                    
                    updateOrder(orderId, updates);
                    alert('–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω');
                    loadInTransitData();
                });
            });
            
            document.querySelectorAll('.delete-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order-id');
                    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
                        deleteOrder(orderId);
                        loadInTransitData();
                    }
                });
            });
        }

        function loadAllUsersData() {
            const users = getAllUsers().filter(user => !user.isAdmin);
            
            allUsersTable.innerHTML = '';
            
            if (users.length === 0) {
                allUsersTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                const regDate = new Date(user.registrationDate).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>${user.code}</td>
                    <td>${user.name}</td>
                    <td>${user.phone}</td>
                    <td>${user.pvz}</td>
                    <td>${regDate}</td>
                    <td>
                        <button class="btn btn-success login-as-user" data-user-id="${user.id}">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                        <button class="btn btn-secondary edit-user" data-user-id="${user.id}">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                        <button class="btn btn-danger delete-user" data-user-id="${user.id}">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                
                allUsersTable.appendChild(row);
            });
            
            document.querySelectorAll('.login-as-user').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    loginAsUser(userId);
                });
            });
            
            document.querySelectorAll('.edit-user').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    changeUserPassword(userId);
                });
            });
            
            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                        deleteUser(userId);
                        loadAllUsersData();
                    }
                });
            });
        }

        function changeUserPassword(userId) {
            const newPassword = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:');
            if (newPassword) {
                updateUser(userId, { password: newPassword });
                alert('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω');
            }
        }

        function displaySearchResults(results) {
            searchResultsTable.innerHTML = '';
            
            if (results.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="6" style="text-align: center;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>';
                searchResultsTable.appendChild(row);
                return;
            }
            
            results.forEach(user => {
                if (user.isAdmin) return;
                
                const row = document.createElement('tr');
                const regDate = new Date(user.registrationDate).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>${user.code}</td>
                    <td>${user.name}</td>
                    <td>${user.phone}</td>
                    <td>${user.pvz}</td>
                    <td>${regDate}</td>
                    <td>
                        <button class="btn btn-success login-as-user" data-user-id="${user.id}">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                        <button class="btn btn-secondary edit-user" data-user-id="${user.id}">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    </td>
                `;
                
                searchResultsTable.appendChild(row);
            });
            
            document.querySelectorAll('#searchResultsTable .login-as-user').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    loginAsUser(userId);
                });
            });
            
            document.querySelectorAll('#searchResultsTable .edit-user').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    changeUserPassword(userId);
                });
            });
        }

        function deleteUser(userId) {
            const users = getAllUsers();
            const updatedUsers = users.filter(user => user.id !== userId);
            safeSetItem('abucargo_users', JSON.stringify(updatedUsers));
            
            const orders = getAllOrders();
            const updatedOrders = orders.filter(order => order.userId !== userId);
            safeSetItem('abucargo_orders', JSON.stringify(updatedOrders));
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∞–π—Ç–∞...');
            
            initDatabase();
            
            let activeUser = null;
            try {
                const localUser = safeGetItem('abucargo_active_user');
                const sessionUser = sessionStorage.getItem('abucargo_active_user');
                
                activeUser = localUser || sessionUser;
                
                if (activeUser) {
                    const user = JSON.parse(activeUser);
                    console.log('–ù–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user.name);
                    showDashboard(user);
                } else {
                    console.log('–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    loginForm.style.display = 'block';
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–∏:', e);
                loginForm.style.display = 'block';
            }
            
            setupEventListeners();
        });
    </script>
</body>
  </html>
